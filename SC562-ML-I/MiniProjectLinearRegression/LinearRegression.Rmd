---
title: "Linear Regression on Concrete Strength Dataset"
output: html_document
df_print: paged
---

<hr style="height:1px; border-width:0; color:black; background-color:black">

# Process the Dataset

<br>

```{r}
#store dataset 
dataset = read.csv("Concrete_Data.csv")

#rename columns of dataset for simplicity
colnames(dataset) = c("Cement","Blast Furnace Slag","Fly Ash","Water","Superplasticizer","Coarse Aggregate","Fine Aggregate","Age","CCS")

#CCS -> Concrete compressive strength

#store the dimensions of dataset
n = nrow(dataset)                         #number of instances
p = ncol(dataset) - 1                     #number of predictors 

```

# Exploratory data analysis

<hr>

## Summary Statistics

| Number of instances: 1030
| Number of Attributes: 9
| Attribute breakdown: 8 quantitative input variables, and 1 quantitative output variable

<br>

```{r,warning=FALSE}
spread = NULL
for(i in 1:p)
  spread = cbind(spread,c(sd(dataset[,i]),range(dataset[,i])))

colnames(spread) = colnames(dataset[1:8])
rownames(spread) = c("Std Deviation","Min","Max")

library(knitr)
kable(spread)

summary(dataset)
```

### Analysis Of Numerical Summaries

<hr>

## Visulaization

<hr>

### Histograms

```{r}
par(mfrow = c(2, 4)) 

for (i in 1:p) {
 hist(dataset[,i],'FD',col = "lightblue",main = paste(colnames(dataset)[i]),xlab = colnames(dataset)[i],probability = TRUE)
  
  abline(v = mean(dataset[,i]) , lty = 2)
}

```

### Boxplots

```{r}
 boxplot(dataset[,1:8], col = "orange", main = "Boxplots for All Predictors", cex.axis = 0.7,
        las = 2)

```

### Interpretations for Predictors

### Pair Plots

```{r}
pairs(dataset[,c(1,2,3,6,7)], main = "Pairplot of Important Predictors", col = "blue",lower.panel = NULL)
```

### Correlations between predictors

<hr>

#### Correlation matrix image

```{r,warning=FALSE}
#Load required libraries
library(ggplot2)
library(reshape)

#calculate correlation and transform it by melt() to make it suitable for ggplot 
cormat = melt(cor(dataset[1:8]))


#plot the correlation and adjust width of x labels
ggplot(data = cormat,aes(x = X1,y = X2,fill = value))+
  geom_tile()  +                     #creates heatmap
  geom_text(aes(label = round(value, 2)), color = "white", size = 4)+                     #Add values inside tiles
scale_x_discrete(labels = function(x) stringr::str_wrap(x, width = 2))                        #Wrap long labels

```

#### Table of correlation and CI for each pair of variables

```{r,warning=FALSE}
cortable = NULL
#Iterate through all predictors
for(i in 1:p)
{
   for(j in (i+1):p)
   {
     #calculate correlation
    test = cor.test(dataset[,i],dataset[,j])
    #extract the necessary information and add to cortable
    cortable = rbind(cortable,c(colnames(dataset)[i],colnames(dataset)[j],signif(test$estimate,3),signif(test$conf.int,3),signif(test$p.value,3))) 
   }
    
}
 
#name the columns
  colnames(cortable) <- c("Predictor1", "Predictor2", "Estimate", "Conf_Int_Lower", "Conf_Int_Upper", "p_value")
  
#exclude the last row 
cortable = cortable[-nrow(cortable),]


#library to display in table format
library(DT)
datatable(cortable, caption = "Correlation Table with Confidence Intervals")

```

#### Interpretation

<hr>

### Correlations between response and predictors

<hr>

#### Table of correlation and CI between response and each predictor

```{r}

cor = NULL
#iterate through predictors 
for(i in 1:p)
 {
  #calculate corelation
  test = cor.test(dataset[,i],dataset$CCS)
  #extract necesscary info and add to cor table
  cor = rbind(cor,c(colnames(dataset)[i],signif(test$estimate,3),signif(test$conf.int,3),signif(test$p.value,3))) 
}

#name the columns
colnames(cor) = c("Predictor","Estimate", "Conf_Int_Lower", "Conf_Int_Upper", "p_value")

#display cor in table format
library(DT)
datatable(cor, caption = "Table of correlation and CI between response and each predictor ")

  
```

#### Interpretation

<hr>

### Questions

<hr>

# Linear Regression Analysis

<br> \## Multiple Linear Regression

```{r}
# Fit multiple linear regression model
model = lm(CCS ~ Cement + ., data = dataset)

# Print model summary
summary(model)

```

## Regression Plots

```{r}
par(mfrow = c(2,4))
# Initialize an empty list to store results
regression_summaries <- list()


for (i in 1:p) {
  predictor <- colnames(dataset)[i]  # Get predictor name
  
  # Fit linear regression
  model <- lm(CCS ~ dataset[[i]], data = dataset)
  
  plot(dataset$CCS,dataset[[i]],col = 'orange',xlab = "Concrete Strength",ylab = paste(predictor))
  
  abline(coef(model),col = 'red')
  
  
  # Extract summary statistics
  summary_fit <- summary(model)
  
  # Store results in a structured table (data frame)
  regression_table <- data.frame(
    Coefficient = summary_fit$coefficients[, 1],  
    Std_Error = summary_fit$coefficients[, 2],  
    t_Statistic = summary_fit$coefficients[, 3],  
    p_Value = summary_fit$coefficients[, 4]  
  )
  
  # Store the table in the list
  regression_summaries[[predictor]] <- regression_table
}
```

## Regression Summaries

```{r}
print(regression_summaries)

```

### Interpretations

<hr>

## Residual Plots

```{r}
par(mfrow = c(2, 4))
for (i in 1:p) {
  # Fit linear regression
  model <- lm(CCS ~ dataset[[i]], data = dataset)
  
  # Extract residual 
  residuals  <- resid(model)
  
  #Plot residuals as function of x
  plot(dataset[[i]],residuals, xlab = paste(colnames(dataset)[i]), ylab = "Residuals", col = "lightpink")
  
  abline(h = 0, col = "red", lwd = 2)  # Add a horizontal line at zero
}

```

<hr>

# Diagnostics

<hr>

# Model Selection

<hr>

## Forward Stepwise Selection

```{r,results='hide'}
#start with empty predictors 
first_start = lm(CCS ~ 1,data = dataset)    
```

### Model Selection Based on AIC Score

```{r,results='hide'}
# Stepwise selection using AIC
stepwise_AIC = step(first_start,direction = "forward",scope = formula(model))
```

```         
Step:  AIC=4832.91 
CCS ~ Cement + Superplasticizer + Age + `Blast Furnace Slag` +      Water + `Fly Ash`
```





